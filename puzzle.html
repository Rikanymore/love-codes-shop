<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anƒ± Par√ßalayƒ±cƒ± | A≈ük Puzzle'ƒ±</title>
    <style>
        body {
            margin: 0; padding: 0; background-color: #0b0f19; color: #fff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            min-height: 100vh; overflow: hidden; touch-action: none;
            background: radial-gradient(circle at center, #1a1b35 0%, #050505 100%);
        }

        .back-btn {
            position: absolute; top: 20px; left: 20px;
            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2); color: #fff;
            padding: 8px 15px; border-radius: 10px; cursor: pointer; text-decoration: none;
            font-size: 0.9rem; z-index: 1000; transition: all 0.3s ease;
        }
        .back-btn:hover { border-color: #ec4899; color: #ec4899; }

        /* --- OYUN ƒ∞STATƒ∞STƒ∞KLERƒ∞ --- */
        .stats-container {
            display: flex; gap: 30px; margin-bottom: 20px; z-index: 10;
        }
        .stat-box {
            background: rgba(20, 25, 40, 0.8); border: 1px solid #ec4899;
            padding: 10px 20px; border-radius: 15px; text-align: center;
            box-shadow: 0 0 15px rgba(236, 72, 153, 0.2);
        }
        .stat-label { font-size: 0.8rem; color: #94a3b8; text-transform: uppercase; }
        .stat-value { font-size: 1.5rem; color: #2dd4bf; font-weight: bold; }

        /* --- POLAROID √áER√áEVESƒ∞ --- */
        .polaroid-wrapper {
            background: transparent; padding: 0; border-radius: 15px;
            transition: all 1.5s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
        }
        
        /* √á√∂z√ºld√ºƒü√ºnde Polaroid'e D√∂n√º≈ü√ºr */
        .polaroid-wrapper.solved {
            background: #fdfbf7; padding: 15px 15px 70px 15px;
            border-radius: 5px; box-shadow: 0 20px 50px rgba(0,0,0,0.8);
            transform: scale(1.05) rotate(-2deg);
            pointer-events: none;
        }

        /* El Yazƒ±sƒ± Not */
        .polaroid-text {
            position: absolute; bottom: 15px; left: 0; width: 100%;
            text-align: center; color: #111; font-size: 1.8rem;
            font-family: 'Brush Script MT', 'Comic Sans MS', cursive;
            opacity: 0; transition: opacity 1s ease 1s;
        }
        .polaroid-wrapper.solved .polaroid-text { opacity: 1; }

        /* --- PUZZLE TAHTASI --- */
        .puzzle-board {
            width: 330px; height: 330px; display: grid;
            grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(3, 1fr);
            gap: 2px; background: #151a28; border-radius: 10px;
            box-shadow: 0 0 30px rgba(0,0,0,0.5); position: relative;
        }

        /* √á√∂z√ºl√ºnce Tahta Ayarlarƒ± */
        .polaroid-wrapper.solved .puzzle-board {
            gap: 0; border-radius: 0; box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }

        /* Puzzle Par√ßasƒ± */
        .piece {
            width: 100%; height: 100%; cursor: pointer; border-radius: 4px;
            transition: transform 0.2s ease, filter 0.2s ease, border-radius 1s ease;
            background-size: 330px 330px;
        }
        .polaroid-wrapper.solved .piece { border-radius: 0; }
        .piece:hover { filter: brightness(1.2); }
        .piece.selected { transform: scale(0.9); box-shadow: 0 0 15px #2dd4bf; border: 2px solid #2dd4bf; z-index: 10; }

        /* ƒ∞pucu G√∂rseli */
        .hint-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-size: 330px 330px; opacity: 0; pointer-events: none;
            transition: opacity 0.3s ease; z-index: 20; border-radius: 10px;
        }
        .hint-overlay.show { opacity: 0.8; }

        /* --- ƒ∞PUCU BUTONU --- */
        .hint-btn {
            margin-top: 30px; background: transparent; color: #ec4899;
            border: 1px solid #ec4899; padding: 12px 30px; border-radius: 30px;
            font-size: 1rem; cursor: pointer; transition: all 0.3s ease;
            user-select: none; -webkit-user-select: none;
        }
        .hint-btn:active, .hint-btn.active { background: #ec4899; color: #fff; box-shadow: 0 0 20px #ec4899; transform: scale(0.95); }

        /* --- Gƒ∞ZLƒ∞ MEKTUP / Fƒ∞NAL EKRANI --- */
        #victory-screen {
            position: fixed; bottom: -100%; left: 0; width: 100%;
            background: linear-gradient(to top, rgba(15, 23, 42, 1) 40%, rgba(15, 23, 42, 0.8) 100%);
            backdrop-filter: blur(10px); display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 40px 20px; box-sizing: border-box; z-index: 100;
            border-top: 2px solid #2dd4bf; transition: bottom 1s cubic-bezier(0.175, 0.885, 0.32, 1.275); text-align: center;
        }
        #victory-screen.show { bottom: 0; }

        .vic-title { color: #2dd4bf; font-size: 2rem; margin-bottom: 15px; }
        .vic-text { color: #f1f5f9; font-size: 1.1rem; max-width: 500px; line-height: 1.6; font-style: italic; }

        /* Konfeti */
        .confetti { position: absolute; width: 10px; height: 10px; z-index: 200; pointer-events: none; }
    </style>
</head>
<body>

    <audio id="bg-music" src="https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3" loop></audio>
    <audio id="click-sound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_73f009bb38.mp3"></audio>
    <audio id="win-sound" src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_0625c1539c.mp3"></audio>

    <a href="index.html" class="back-btn">‚Üê Maƒüazaya D√∂n</a>

    <div class="stats-container" id="stats">
        <div class="stat-box">
            <div class="stat-label">S√ºre</div>
            <div class="stat-value" id="timer">00:00</div>
        </div>
        <div class="stat-box">
            <div class="stat-label">Hamle</div>
            <div class="stat-value" id="moves">0</div>
        </div>
    </div>

    <div class="polaroid-wrapper" id="polaroid">
        <div class="puzzle-board" id="board">
            <div class="hint-overlay" id="hint-overlay"></div>
            </div>
        <div class="polaroid-text" id="polaroid-note">Seni Seviyorum</div>
    </div>

    <button class="hint-btn" id="hint-btn">ƒ∞pucu ƒ∞√ßin Basƒ±lƒ± Tut üëÅÔ∏è</button>

    <div id="victory-screen">
        <div class="vic-title" id="vic-title">B√ºy√ºk S√ºrpriz!</div>
        <div class="vic-text" id="vic-text">Gizli mesaj buraya gelecek...</div>
    </div>

    <script>
        // ==========================================
        // üõ†Ô∏è M√ú≈ûTERƒ∞ Sƒ∞PARƒ∞≈û AYARLARI
        // ==========================================
        
        // YENƒ∞ FOTOƒûRAF Lƒ∞NKƒ∞ (Demo i√ßin garantili √ßalƒ±≈üan bir doƒüa fotoƒürafƒ±)
        const FOTOGRAF_LINKI = "https://images.unsplash.com/photo-1506744038136-46273834b3fb?w=330&h=330&fit=crop"; 
        
        const POLAROID_NOTU = "Doƒüanƒ±n g√ºzelliƒüi gibi... üåø";
        const SURPRIZ_BASLIK = "Tebrikler!";
        const SURPRIZ_MESAJ = "Par√ßalarƒ± birle≈ütirmek senin i≈üin! Bu fotoƒüraf, birlikte ke≈üfedeceƒüimiz nice g√ºzel manzaralarƒ±n sadece bir ba≈ülangƒ±cƒ±...";

        // ==========================================

        document.getElementById('polaroid-note').innerText = POLAROID_NOTU;
        document.getElementById('vic-title').innerText = SURPRIZ_BASLIK;
        document.getElementById('vic-text').innerText = SURPRIZ_MESAJ;

        const board = document.getElementById('board');
        const polaroidWrapper = document.getElementById('polaroid');
        const hintOverlay = document.getElementById('hint-overlay');
        const hintBtn = document.getElementById('hint-btn');
        const moveDisplay = document.getElementById('moves');
        const timeDisplay = document.getElementById('timer');
        
        const clickSound = document.getElementById('click-sound');
        const winSound = document.getElementById('win-sound');
        const bgMusic = document.getElementById('bg-music');
        clickSound.volume = 0.5; bgMusic.volume = 0.3;

        hintOverlay.style.backgroundImage = `url('${FOTOGRAF_LINKI}')`;

        let pieces = [];
        let selectedPiece = null;
        let isGameStarted = false;
        let isGameWon = false;
        
        // Saya√ß Deƒüi≈ükenleri
        let moves = 0;
        let seconds = 0;
        let timerInterval = null;

        const gridSize = 3;
        const totalPieces = gridSize * gridSize;

        function initPuzzle() {
            let order = Array.from(Array(totalPieces).keys());
            
            do {
                order.sort(() => Math.random() - 0.5);
            } while (isSolved(order)); 

            order.forEach((correctIndex, currentIndex) => {
                const piece = document.createElement('div');
                piece.classList.add('piece');
                piece.style.backgroundImage = `url('${FOTOGRAF_LINKI}')`;
                
                const row = Math.floor(correctIndex / gridSize);
                const col = correctIndex % gridSize;
                piece.style.backgroundPosition = `-${col * 110}px -${row * 110}px`;
                
                piece.dataset.correctIndex = correctIndex;
                piece.dataset.currentIndex = currentIndex;
                
                piece.addEventListener('click', handlePieceClick);
                
                board.appendChild(piece);
                pieces.push(piece);
            });
        }

        function startTimer() {
            if(timerInterval) return;
            timerInterval = setInterval(() => {
                seconds++;
                let m = Math.floor(seconds / 60).toString().padStart(2, '0');
                let s = (seconds % 60).toString().padStart(2, '0');
                timeDisplay.innerText = `${m}:${s}`;
            }, 1000);
        }

        function handlePieceClick(e) {
            if(isGameWon) return;

            if (!isGameStarted) {
                bgMusic.play().catch(() => {});
                startTimer();
                isGameStarted = true;
            }

            clickSound.currentTime = 0;
            clickSound.play();

            const clickedPiece = e.target;

            if (!selectedPiece) {
                selectedPiece = clickedPiece;
                selectedPiece.classList.add('selected');
            } else {
                if (selectedPiece !== clickedPiece) {
                    swapPieces(selectedPiece, clickedPiece);
                    moves++;
                    moveDisplay.innerText = moves;
                }
                selectedPiece.classList.remove('selected');
                selectedPiece = null;
                checkWin();
            }
        }

        function swapPieces(piece1, piece2) {
            const index1 = Array.from(board.children).indexOf(piece1);
            const index2 = Array.from(board.children).indexOf(piece2);

            const tempCurrent = piece1.dataset.currentIndex;
            piece1.dataset.currentIndex = piece2.dataset.currentIndex;
            piece2.dataset.currentIndex = tempCurrent;

            if (index1 < index2) {
                board.insertBefore(piece2, piece1);
                board.insertBefore(piece1, board.children[index2]);
            } else {
                board.insertBefore(piece1, piece2);
                board.insertBefore(piece2, board.children[index1]);
            }
        }

        function isSolved(order) {
            for (let i = 0; i < order.length; i++) {
                if (order[i] !== i) return false;
            }
            return true;
        }

        function checkWin() {
            let isWin = true;
            const currentPieces = document.querySelectorAll('.piece');
            
            currentPieces.forEach((piece, index) => {
                // +1 ekliyoruz √ß√ºnk√º DOM'da ilk eleman hint-overlay div'i
                if (parseInt(piece.dataset.correctIndex) !== index - 1) {
                    isWin = false;
                }
            });

            if (isWin) triggerVictory();
        }

        function triggerVictory() {
            isGameWon = true;
            clearInterval(timerInterval);
            
            // UI Elementlerini Gizle
            document.getElementById('stats').style.opacity = '0';
            hintBtn.style.opacity = '0';
            
            // Polaroid Efektini Tetikle
            polaroidWrapper.classList.add('solved');
            
            bgMusic.pause();
            winSound.play();

            setTimeout(() => {
                document.getElementById('victory-screen').classList.add('show');
                createConfetti();
            }, 1500);
        }

        function createConfetti() {
            const colors = ['#ec4899', '#2dd4bf', '#fde047', '#fff'];
            for (let i = 0; i < 50; i++) {
                let confetti = document.createElement('div');
                confetti.classList.add('confetti');
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.top = '-10px';
                confetti.style.transition = `transform ${Math.random() * 2 + 1.5}s linear`;
                document.body.appendChild(confetti);
                setTimeout(() => { confetti.style.transform = `translateY(100vh) rotate(${Math.random() * 720}deg)`; }, 50);
            }
        }

        // ƒ∞PUCU BUTONU MEKANƒ∞ƒûƒ∞
        const showHint = () => { hintOverlay.classList.add('show'); hintBtn.classList.add('active'); };
        const hideHint = () => { hintOverlay.classList.remove('show'); hintBtn.classList.remove('active'); };

        hintBtn.addEventListener('mousedown', showHint);
        hintBtn.addEventListener('mouseup', hideHint);
        hintBtn.addEventListener('mouseleave', hideHint);
        hintBtn.addEventListener('touchstart', showHint, {passive: true});
        hintBtn.addEventListener('touchend', hideHint);

        window.onload = initPuzzle;
    </script>
</body>
</html>