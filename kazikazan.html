<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sonsuz AÅŸk | Ã–zel Kuponlar</title>
    <style>
        /* --- GENEL ATMOSFER --- */
        body {
            margin: 0; padding: 0; background-color: #110307; color: #fff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            min-height: 100vh; overflow-x: hidden; touch-action: pan-y; /* AÅŸaÄŸÄ± kaydÄ±rmaya izin ver */
            background: radial-gradient(circle at center, #2e0813 0%, #0a0103 100%);
        }

        .back-btn {
            position: fixed; top: 15px; left: 15px;
            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2); color: #fff;
            padding: 8px 15px; border-radius: 10px; cursor: pointer; text-decoration: none;
            font-size: 0.9rem; z-index: 1000; transition: all 0.3s ease;
        }
        .back-btn:hover { border-color: #f43f5e; color: #f43f5e; }

        /* --- ATEÅBÃ–CEKLERÄ° EFEKTÄ° --- */
        #fireflies-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
        .firefly {
            position: absolute; width: 4px; height: 4px; background: #fca5a5;
            border-radius: 50%; box-shadow: 0 0 10px 2px #f43f5e;
            animation: float 10s infinite ease-in-out alternate;
        }
        @keyframes float {
            0% { transform: translateY(0) translateX(0) scale(1); opacity: 0.2; }
            100% { transform: translateY(-100px) translateX(50px) scale(1.5); opacity: 0.8; }
        }

        /* --- 1. AÅAMA: MÃœHÃœRLÃœ GÄ°RÄ°Å --- */
        #intro-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 500; background: rgba(10, 1, 3, 0.95); backdrop-filter: blur(10px);
            transition: opacity 1s ease;
        }
        .wax-seal {
            width: 120px; height: 120px; background: radial-gradient(circle, #be123c, #881337);
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            font-size: 3rem; cursor: pointer; box-shadow: 0 10px 30px rgba(190, 18, 60, 0.5), inset 0 0 15px rgba(0,0,0,0.5);
            border: 4px solid #f43f5e; animation: heartbeat 1.5s infinite;
        }
        @keyframes heartbeat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); box-shadow: 0 10px 50px rgba(244, 63, 94, 0.8); } }
        .intro-text { margin-top: 30px; font-size: 1.2rem; color: #fda4af; letter-spacing: 2px; text-transform: uppercase; text-align: center; }

        /* --- 2. AÅAMA: 6'LI KUPON IZGARASI --- */
        #main-content {
            display: flex; flex-direction: column; align-items: center;
            opacity: 0; transform: scale(0.9); pointer-events: none;
            transition: all 1s ease; z-index: 10; padding: 60px 20px 120px 20px;
            width: 100%; max-width: 800px; box-sizing: border-box;
        }
        #main-content.active { opacity: 1; transform: scale(1); pointer-events: auto; }

        .header-title { color: #fca5a5; font-size: 2rem; margin-bottom: 10px; text-align: center; text-shadow: 0 2px 10px rgba(244, 63, 94, 0.5); }
        .header-subtitle { color: #f1f5f9; font-size: 1rem; margin-bottom: 30px; text-align: center; opacity: 0.8; }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 20px; width: 100%;
        }

        /* Tekil Kupon TasarÄ±mÄ± */
        .card-item {
            position: relative; width: 100%; aspect-ratio: 1 / 1; /* Kare yapar */
            border-radius: 15px; box-shadow: 0 10px 30px rgba(244, 63, 94, 0.2);
            border: 2px solid #fca5a5; overflow: hidden; background: #fff;
            display: flex; justify-content: center; align-items: center;
        }

        .secret-content {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: linear-gradient(135deg, #fff1f2, #ffe4e6); z-index: 1; padding: 10px; box-sizing: border-box;
        }
        .secret-icon { font-size: 3rem; margin-bottom: 10px; filter: drop-shadow(0 5px 5px rgba(0,0,0,0.2)); }
        .secret-text { color: #be123c; font-size: 1rem; font-weight: bold; text-align: center; line-height: 1.2; }

        /* AltÄ±n/GÃ¼mÃ¼ÅŸ Canvas KatmanÄ± */
        .scratch-canvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 2; cursor: pointer; transition: opacity 0.5s ease;
        }

        /* --- AÅAMA 3'E GEÃ‡Ä°Å BUTONU --- */
        .finale-section {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: linear-gradient(to top, #110307 50%, transparent);
            padding: 40px 20px 20px 20px; display: flex; justify-content: center;
            pointer-events: none; z-index: 20;
        }

        .read-letter-btn {
            background: linear-gradient(45deg, #f43f5e, #be123c); color: white;
            border: none; padding: 15px 40px; font-size: 1.2rem; font-weight: bold;
            border-radius: 30px; cursor: pointer; box-shadow: 0 0 20px rgba(244, 63, 94, 0.6);
            opacity: 0; transform: translateY(50px); transition: all 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: none;
        }
        .read-letter-btn.show { opacity: 1; transform: translateY(0); pointer-events: auto; animation: pulse-btn 2s infinite; }
        @keyframes pulse-btn { 0%, 100% { box-shadow: 0 0 20px rgba(244, 63, 94, 0.6); } 50% { box-shadow: 0 0 40px rgba(244, 63, 94, 1); } }

        /* --- 3. AÅAMA: ROMANTÄ°K MEKTUP EKRANI --- */
        #letter-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(10, 1, 3, 0.95); backdrop-filter: blur(15px);
            display: flex; justify-content: center; align-items: center;
            z-index: 1000; opacity: 0; pointer-events: none; transition: opacity 0.8s ease;
        }
        #letter-modal.open { opacity: 1; pointer-events: auto; }

        .letter-paper {
            width: 90%; max-width: 450px; max-height: 80vh; overflow-y: auto;
            background: #fdfbf7; color: #3a0a18; padding: 40px; border-radius: 10px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5); font-family: 'Georgia', serif;
            line-height: 1.8; position: relative;
        }
        .letter-paper::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: url('https://www.transparenttextures.com/patterns/cream-paper.png');
            opacity: 0.5; pointer-events: none;
        }
        .letter-header { font-size: 2rem; color: #be123c; margin-bottom: 20px; font-style: italic; text-align: center; }
        .letter-body { font-size: 1.1rem; text-align: justify; margin-bottom: 30px; white-space: pre-wrap; }
        .letter-footer { text-align: right; font-weight: bold; font-size: 1.2rem; color: #be123c; font-style: italic; }
        .close-letter { position: absolute; top: 15px; right: 20px; font-size: 2rem; color: #be123c; cursor: pointer; }

        /* Konfeti */
        .confetti { position: fixed; width: 10px; height: 10px; animation: fall linear forwards; z-index: 2000; pointer-events: none;}
        @keyframes fall { to { transform: translateY(100vh) rotate(720deg); } }
    </style>
</head>
<body>

    <audio id="bg-music" src="https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3" loop></audio>
    <audio id="scratch-sound" src="https://cdn.pixabay.com/download/audio/2023/02/28/audio_824cd1dbfc.mp3" loop></audio>
    <audio id="magic-sound" src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_0625c1539c.mp3"></audio>

    <a href="index.html" class="back-btn">â† Ã‡Ä±kÄ±ÅŸ</a>

    <div id="fireflies-container"></div>

    <div id="intro-screen">
        <div class="wax-seal" onclick="startJourney()">ğŸ’Œ</div>
        <div class="intro-text">Sana Ã–zel 6 SÃ¼rpriz Kupon<br><span style="font-size: 0.8rem; color: #94a3b8;">MÃ¼hrÃ¼ KÄ±rmak Ä°Ã§in Dokun</span></div>
    </div>

    <div id="main-content">
        <h1 class="header-title">AÅŸk KuponlarÄ±mÄ±z</h1>
        <p class="header-subtitle">Hepsini kazÄ±, sÃ¼rprizleri keÅŸfet!</p>
        
        <div class="cards-grid" id="cards-grid">
            </div>
    </div>

    <div class="finale-section">
        <button class="read-letter-btn" id="read-btn" onclick="openLetter()">AsÄ±l Hediyeni GÃ¶r ğŸ’Œ</button>
    </div>

    <div id="letter-modal">
        <div class="letter-paper">
            <div class="close-letter" onclick="closeLetter()">Ã—</div>
            <div class="letter-header" id="letter-header">Sevgilim,</div>
            <div class="letter-body" id="letter-body">Uzun aÅŸk mektubu buraya...</div>
            <div class="letter-footer" id="letter-footer">- Sonsuz AÅŸkÄ±n</div>
        </div>
    </div>

    <script>
        // ==========================================
        // ğŸ› ï¸ MÃœÅTERÄ° SÄ°PARÄ°Å AYARLARI
        // ==========================================
        
        // --- 6'LI KUPON Ä°Ã‡ERÄ°KLERÄ° ---
        // MÃ¼ÅŸteri sana "neler yazsÄ±n" diyecek, sen burayÄ± deÄŸiÅŸtireceksin.
        const KUPONLAR = [
            { icon: "ğŸ•", metin: "Ä°stediÄŸin Bir Yemek" },
            { icon: "ğŸ’†â€â™€ï¸", metin: "1 Saat Masaj" },
            { icon: "ğŸ¬", metin: "Sinema Gecesi" },
            { icon: "âœˆï¸", metin: "Hafta Sonu KaÃ§amaÄŸÄ±" },
            { icon: "â˜•", metin: "1 AylÄ±k Kahve" },
            { icon: "ğŸ«‚", metin: "SÄ±nÄ±rsÄ±z SarÄ±lma" }
        ];

        // --- UZUN AÅK MEKTUBU (Hepsini kazÄ±yÄ±nca Ã§Ä±kacak) ---
        const MEKTUP_HITAP = "HayatÄ±mÄ±n AnlamÄ±na,";
        const MEKTUP_ICERIK = "UmarÄ±m kuponlarÄ± beÄŸenmiÅŸsindir! Ä°stediÄŸin zaman kullanabilirsin.\n\nSeninle tanÄ±ÅŸtÄ±ÄŸÄ±m o ilk gÃ¼nden beri hayatÄ±mdaki tÃ¼m renkler deÄŸiÅŸti. Beraber gÃ¼ldÃ¼ÄŸÃ¼mÃ¼z, saatlerce sohbet ettiÄŸimiz her anÄ± kalbimin en derin kÃ¶ÅŸesinde saklÄ±yorum.\n\nEllerimizi hiÃ§ bÄ±rakmamamÄ±z dileÄŸiyle. Seni her ÅŸeyden Ã§ok seviyorum.";
        const MEKTUP_IMZA = "- Seni Ã‡ok Seven...";

        // ==========================================

        // DOM Elementlerini Ayarla
        document.getElementById('letter-header').innerText = MEKTUP_HITAP;
        document.getElementById('letter-body').innerText = MEKTUP_ICERIK;
        document.getElementById('letter-footer').innerText = MEKTUP_IMZA;

        // AteÅŸbÃ¶cekleri OluÅŸtur
        const firefliesContainer = document.getElementById('fireflies-container');
        for(let i=0; i<40; i++) {
            let firefly = document.createElement('div');
            firefly.className = 'firefly';
            firefly.style.left = Math.random() * 100 + 'vw';
            firefly.style.top = Math.random() * 100 + 'vh';
            firefly.style.animationDuration = (Math.random() * 5 + 5) + 's';
            firefly.style.animationDelay = (Math.random() * 5) + 's';
            firefliesContainer.appendChild(firefly);
        }

        const introScreen = document.getElementById('intro-screen');
        const mainContent = document.getElementById('main-content');
        const bgMusic = document.getElementById('bg-music');
        const scratchSound = document.getElementById('scratch-sound');
        const magicSound = document.getElementById('magic-sound');
        const readBtn = document.getElementById('read-btn');
        const cardsGrid = document.getElementById('cards-grid');

        bgMusic.volume = 0.3;
        scratchSound.volume = 0.5;

        let revealedCardsCount = 0; // KaÃ§ tane kart aÃ§Ä±ldÄ±?

        // KartlarÄ± JavaScript ile HTML'e ekle
        function createCards() {
            KUPONLAR.forEach((kupon, index) => {
                const cardHtml = `
                    <div class="card-item">
                        <div class="secret-content">
                            <div class="secret-icon">${kupon.icon}</div>
                            <div class="secret-text">${kupon.metin}</div>
                        </div>
                        <canvas class="scratch-canvas" id="canvas-${index}"></canvas>
                    </div>
                `;
                cardsGrid.innerHTML += cardHtml;
            });

            // Kartlar eklendikten sonra canvaslarÄ± ayarla
            setTimeout(initCanvases, 100);
        }

        // TÃ¼m CanvaslarÄ± BaÅŸlat
        function initCanvases() {
            const canvases = document.querySelectorAll('.scratch-canvas');
            canvases.forEach(canvas => {
                const ctx = canvas.getContext('2d');
                canvas.width = canvas.parentElement.offsetWidth;
                canvas.height = canvas.parentElement.offsetHeight;
                
                // AltÄ±n KatmanÄ± Ã‡iz
                const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                gradient.addColorStop(0, '#fda4af'); 
                gradient.addColorStop(0.5, '#f43f5e'); 
                gradient.addColorStop(1, '#9f1239'); 
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                ctx.font = "bold 20px 'Segoe UI'";
                ctx.fillStyle = "#fff"; 
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                ctx.fillText("KazÄ± ğŸª™", canvas.width / 2, canvas.height / 2);

                // Bu canvas iÃ§in Ã¶zel deÄŸiÅŸkenler
                canvas.isDrawing = false;
                canvas.isRevealed = false;

                // Event Listener'lar
                const startScratch = (e) => {
                    if (canvas.isRevealed) return;
                    canvas.isDrawing = true;
                    scratchSound.play();
                    scratchObj(e, canvas, ctx);
                };

                const moveScratch = (e) => {
                    if (!canvas.isDrawing || canvas.isRevealed) return;
                    e.preventDefault(); 
                    scratchObj(e, canvas, ctx);
                };

                const stopScratch = () => {
                    canvas.isDrawing = false;
                    scratchSound.pause();
                };

                canvas.addEventListener('mousedown', startScratch);
                canvas.addEventListener('mousemove', moveScratch);
                canvas.addEventListener('mouseup', stopScratch);
                canvas.addEventListener('mouseleave', stopScratch);
                canvas.addEventListener('touchstart', startScratch, {passive: false});
                canvas.addEventListener('touchmove', moveScratch, {passive: false});
                canvas.addEventListener('touchend', stopScratch);
            });
        }

        // KazÄ±ma FiziÄŸi
        function scratchObj(e, canvas, ctx) {
            const rect = canvas.getBoundingClientRect();
            let clientX = e.clientX || (e.touches && e.touches[0].clientX);
            let clientY = e.clientY || (e.touches && e.touches[0].clientY);
            let x = clientX - rect.left;
            let y = clientY - rect.top;

            ctx.globalCompositeOperation = 'destination-out';
            ctx.beginPath();
            ctx.arc(x, y, 20, 0, Math.PI * 2); 
            ctx.fill();

            checkPercent(canvas, ctx);
        }

        // YÃ¼zde KontrolÃ¼ ve AÃ§Ä±lma
        function checkPercent(canvas, ctx) {
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const pixels = imageData.data;
            let transparentPixels = 0;

            for (let i = 3; i < pixels.length; i += 16) {
                if (pixels[i] === 0) transparentPixels++;
            }

            const totalPixels = (canvas.width * canvas.height) / 4; 
            const percent = (transparentPixels / totalPixels) * 100;

            if (percent > 45 && !canvas.isRevealed) {
                canvas.isRevealed = true;
                canvas.style.opacity = "0"; 
                magicSound.currentTime = 0;
                magicSound.play();  
                
                setTimeout(() => { canvas.style.display = "none"; }, 500);

                // KaÃ§ kart aÃ§Ä±ldÄ±ÄŸÄ±nÄ± say
                revealedCardsCount++;
                if(revealedCardsCount === KUPONLAR.length) {
                    triggerFinale();
                }
            }
        }

        // TÃ¼m Kartlar AÃ§Ä±lÄ±nca Olacaklar
        function triggerFinale() {
            createConfetti();
            setTimeout(() => {
                readBtn.classList.add('show');
            }, 1000);
        }

        function createConfetti() {
            const colors = ['#f43f5e', '#fca5a5', '#be123c', '#fff'];
            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    let confetti = document.createElement('div');
                    confetti.classList.add('confetti');
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDuration = (Math.random() * 2 + 1.5) + 's';
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 4000);
                }, i * 20); 
            }
        }

        // MÃ¼hrÃ¼ KÄ±r ve BaÅŸla
        function startJourney() {
            bgMusic.play().catch(e => console.log("MÃ¼zik izni yok"));
            introScreen.style.opacity = '0';
            setTimeout(() => {
                introScreen.style.display = 'none';
                mainContent.classList.add('active');
            }, 1000);
        }

        // Mektubu AÃ§/Kapat
        const letterModal = document.getElementById('letter-modal');
        function openLetter() { letterModal.classList.add('open'); }
        function closeLetter() { letterModal.classList.remove('open'); }

        // Sayfa yÃ¼klendiÄŸinde kartlarÄ± oluÅŸtur
        window.onload = createCards;

    </script>
</body>
</html>